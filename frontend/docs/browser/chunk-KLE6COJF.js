import{a as r}from"./chunk-7VWXCVTQ.js";import{r as h}from"./chunk-NPH7NEJF.js";import{J as n,M as a,R as u,g as s}from"./chunk-3ZPPO4HR.js";var p=class i{constructor(t){this.http=t;this.syncWithServer()}authApi=`${r.apiBaseUrl}/auth`;userApi=`${r.apiBaseUrl}/user`;currentUserSubject=new s(null);currentUser$=this.currentUserSubject.asObservable();signup(t){return this.http.post(`${this.authApi}/signup`,t,{withCredentials:!0})}signin(t){return this.http.post(`${this.authApi}/signin`,t,{withCredentials:!0}).pipe(n(e=>{this.setCurrentUser(e)}))}logout(){this.isBrowser()&&(localStorage.removeItem("user"),this.currentUserSubject.next(null))}syncWithServer(){this.http.get(`${this.authApi}/current-user`,{withCredentials:!0}).subscribe({next:t=>{this.setCurrentUser(t)},error:()=>{this.logout()}})}setCurrentUser(t){this.isBrowser()&&(localStorage.setItem("user",JSON.stringify(t)),this.currentUserSubject.next(t))}getCurrentUser(){if(!this.isBrowser())return null;let t=localStorage.getItem("user");return t?JSON.parse(t):null}isBrowser(){return typeof window<"u"}getAllUsers(){return this.http.get(`${this.authApi}/users`,{withCredentials:!0})}getUserById(t){return this.http.get(`${this.authApi}/users/${t}`,{withCredentials:!0})}getUserAddresses(t){return this.http.get(`${r.apiBaseUrl}/address/${t}`,{withCredentials:!0})}updateProfile(t,e){return this.http.put(`${this.authApi}/update-profile/${t}`,e,{withCredentials:!0})}updateActivity(t){return this.http.post(`${this.userApi}/update-activity/${t}`,{},{withCredentials:!0})}getActiveUsers(){return this.http.get(`${this.userApi}/active-users`,{withCredentials:!0})}startActivityPing(t){setInterval(()=>{this.updateActivity(t).subscribe()},3e4)}static \u0275fac=function(e){return new(e||i)(u(h))};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};export{p as a};
