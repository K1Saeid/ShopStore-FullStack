<h2 class="page-title">Customer Details</h2>

<div *ngIf="loading">Loading...</div>
<div *ngIf="error">{{ error }}</div>

<div *ngIf="!loading && customer" class="details-wrapper">

  <!-- LEFT SIDE -->
  <div class="left-column">

    <!-- PERSONAL INFO -->
    <div class="card">
      <h3 class="section-title">Personal Info</h3>

      <div class="info-row"><strong>Full Name:</strong> {{ customer.fullName }}</div>
      <div class="info-row"><strong>Email:</strong> {{ customer.email }}</div>
      <div class="info-row"><strong>Phone:</strong> {{ customer.phone || '-' }}</div>
      <div class="info-row"><strong>Registered:</strong> {{ customer.createdAt | date:'medium' }}</div>
      <div class="info-row"><strong>Last Login:</strong> {{ customer.lastLoginAt ? (customer.lastLoginAt | date:'medium') : 'Never' }}</div>
      <div class="info-row"><strong>Status:</strong> {{ customer.status }}</div>
      <div class="info-row"><strong>Role:</strong> {{ customer.role }}</div>

    </div>

    <!-- ADDRESSES -->
    <div class="card">
      <div class="flex-between">
        <h3 class="section-title">Addresses</h3>
        <button class="btn-add" (click)="openAddModal()">+ Add</button>
      </div>

      <div *ngIf="addresses.length > 0; else noAddress">
        <div *ngFor="let addr of addresses" class="address-item">
          <p class="addr-line"><strong>{{ addr.addressLine }}</strong></p>
          <p class="addr-sub">{{ addr.city }} - {{ addr.province }} - {{ addr.postalCode }}</p>

          <div class="addr-actions">
            <button class="btn-mini edit" (click)="startEdit(addr)">Edit</button>
            <button class="btn-mini delete" (click)="openDeleteModal(addr.id)">Delete</button>
          </div>
        </div>
      </div>

      <ng-template #noAddress>
        <p class="empty">No addresses found.</p>
      </ng-template>

    </div>

  </div>

  <!-- RIGHT SIDE - ORDERS -->
  <div class="right-column">

    <div class="card">
      <h3 class="section-title">Orders</h3>

      <div *ngIf="orders.length > 0; else noOrders">
        <div *ngFor="let order of paginatedOrders"  class="order-box clickable"
     [routerLink]="['/admin/orders', order.id]" [queryParams]="{ from: 'customer', customerId: customer.id }">
          <div class="order-header">
            <strong>Order #{{ order.id }}</strong>
            <span class="order-status">{{ order.status }}</span>
          </div>

          <div class="order-body">
            <p><strong>Date:</strong> {{ order.createdAt | date:'medium' }}</p>
            <p><strong>Total:</strong> â‚¬ {{ order.totalPrice }}</p>
          </div>
        </div>
      </div>

      <ng-template #noOrders>
        <p class="empty">No orders found.</p>
      </ng-template>

    </div>
<app-pagination
  [totalItems]="orders.length"
  [pageSize]="ordersPageSize"
  [(currentPage)]="ordersPage">
</app-pagination>
<p></p>
  </div>


</div>


<!-- MODAL BACKDROP -->
<div class="modal-backdrop" *ngIf="modalOpen" (click)="closeModal()"></div>

<!-- MODAL -->
<div class="modal" *ngIf="modalOpen">
  <div class="modal-content" (click)="$event.stopPropagation()">

    <h3>{{ isEditing ? 'Edit Address' : 'Add New Address' }}</h3>

    <input class="input" placeholder="Address" [(ngModel)]="addressForm.addressLine" />
    <input class="input" placeholder="City" [(ngModel)]="addressForm.city" />
    <input class="input" placeholder="Province" [(ngModel)]="addressForm.province" />
    <input class="input" placeholder="Postal Code" [(ngModel)]="addressForm.postalCode" />

    <div class="modal-actions">
      <button class="btn btn-dark" (click)="saveAddress()">
        {{ isEditing ? 'Save Changes' : 'Add Address' }}
      </button>
      <button class="btn btn-cancel" (click)="closeModal()">Cancel</button>
    </div>

  </div>
</div>

<!-- DELETE MODAL -->
<div class="modal-backdrop" *ngIf="deleteModalOpen" (click)="closeDeleteModal()"></div>

<div class="modal" *ngIf="deleteModalOpen">
  <div class="modal-content delete-modal" (click)="$event.stopPropagation()">

    <h3>Delete Address?</h3>
    <p>Are you sure you want to delete this address?</p>

    <div class="modal-actions">
      <button class="btn btn-delete" (click)="confirmDelete()">Delete</button>
      <button class="btn btn-cancel" (click)="closeDeleteModal()">Cancel</button>
    </div>

  </div>
</div>
