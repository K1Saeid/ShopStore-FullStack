<div class="dashboard-container">

  <!-- ===================== KPI CARDS ====================== -->
   <h3 class="pt-3">Total Stats</h3>
  <div class="kpi-grid">

    <div class="kpi-card">
      <h4>Total Revenue</h4>
      <p class="value">€{{ stats.totalRevenue }}</p>
    </div>

    <div class="kpi-card">
      <h4>Revenue (Last 7 Days)</h4>
      <p class="value">€{{ stats.last7DaysRevenue }}</p>
    </div>

    <div class="kpi-card">
      <h4>Total Orders</h4>
      <p class="value">{{ stats.totalOrders }}</p>
    </div>

    <div class="kpi-card">
      <h4>Total Customers</h4>
      <p class="value">{{ stats.totalCustomers }}</p>
    </div>

    <div class="kpi-card">
      <h4>Total Products</h4>
      <p class="value">{{ stats.totalProducts }}</p>
    </div>

  </div>
  

<h3 class="pt-3">Today's Stats</h3>
<div class="kpi-grid">

  <div class="kpi-card">
    <h4>Today's Revenue</h4>
    <p class="value">€{{ todayStats.revenueToday }}</p>
  </div>

  <div class="kpi-card">
    <h4>Orders Today</h4>
    <p class="value">{{ todayStats.orderCount }}</p>
  </div>

  <div class="kpi-card">
    <h4>New Customers Today</h4>
    <p class="value">{{ todayStats.newCustomersToday }}</p>
  </div>

  <div class="kpi-card">
    <h4>Avg Order Value</h4>
    <p class="value">€{{ todayStats.avgOrderValue }}</p>
  </div>

</div>
<div class="container-section ">
  <div class="chart-box section-box">
    <h3>Order Status</h3>
    <canvas id="orderStatusChart"></canvas>
  </div>


  <!-- ===================== SALES CHART ====================== -->
  <div class="chart-box section-box">
    <select [(ngModel)]="selectedRange" (change)="loadSales()" class="form-select w-auto pb-2">
      <option value="daily">Daily</option>
      <option value="weekly">Last 7 Days</option>
      <option value="monthly">Last 30 Days</option>
      <option value="yearly">Last 12 Months</option>
  </select>

    <h3 class="pt-3">Sales (Last 7 Days)</h3>
    <canvas id="salesChart"></canvas>

  </div>

</div>


  <!-- ===================== LATEST ORDERS ====================== -->
  <div class="section-box">
    <h3>Latest Orders</h3>

    <table class="styled-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Customer</th>
          <th>Order No</th>
          <th>Total</th>
          <th>Status</th>
          <th>Date</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let o of latestOrders; let i = index">
          <td>{{ i + 1 }}</td>
         <td>
          <a [routerLink]="['/admin/customers', o.user.id]" class="customer-link">
            {{ o.user.fullName }}
          </a>
        </td>
          <td>{{ o.orderNumber }}</td>
          <td>€{{ o.totalPrice }}</td>

          <td>
            <span class="status" 
              [class.paid]="o.status === 'Paid'"
              [class.pending]="o.status === 'Pending'"
              [class.cancelled]="o.status === 'Cancelled'">
              {{ o.status }}
            </span>
          </td>

          <td>{{ o.createdAt | date:'medium' }}</td>

          <td>
            <button class="btn-view" [routerLink]="['/admin/orders', o.id]" [queryParams]="{ from: 'dashboard' }">
              View
            </button>

          </td>
        </tr>
      </tbody>

    </table>

  </div>


  <!-- ===================== LOW STOCK PRODUCTS ====================== -->
   <div class="container-section">
  <div class="section-box ">
    <h3>Low Stock Products</h3>

    <table class="styled-table" *ngIf="lowStock.length > 0; else noLowStock">
      <thead>
        <tr>
          <th>Product</th>
          <th>Stock</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let p of lowStock">
          <td>{{ p.name }}</td>
          <td class="warning">{{ p.stock }}</td>
        </tr>
      </tbody>
    </table>

    <ng-template #noLowStock>
      <p class="empty">All products have sufficient stock.</p>
    </ng-template>
  </div>


  <!-- ===================== TOP SELLING ====================== -->
  <div class="section-box">
    <h3>Top Selling Products</h3>

    <table class="styled-table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Sold</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let p of topSelling">
          <td>{{ p.name }}</td>
          <td>{{ p.sold }}</td>
        </tr>
      </tbody>

    </table>
  </div>
</div>
</div>
